<div class="highlight"><pre><span class="o">&lt;</span><span class="n">application</span> <span class="o">...</span> <span class="o">&gt;</span>
    <span class="o">...</span>
    <span class="o">&lt;!--</span> <span class="n">The</span> <span class="n">main</span><span class="o">/</span><span class="n">home</span> <span class="nf">activity</span> <span class="o">(</span><span class="n">has</span> <span class="n">no</span> <span class="n">parent</span> <span class="n">activity</span><span class="o">)</span> <span class="o">--&gt;</span>
    <span class="o">&lt;!--</span> <span class="o">&lt;</span><span class="n">activity</span>
        <span class="nl">android:</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;com.example.myfirstapp.MainActivity&quot;</span> <span class="o">...&gt;</span>
        <span class="o">...</span>
    <span class="o">&lt;/</span><span class="n">activity</span><span class="o">&gt;</span>
    <span class="o">&lt;!--</span> <span class="n">A</span> <span class="n">child</span> <span class="n">of</span> <span class="n">the</span> <span class="n">main</span> <span class="n">activity</span> <span class="o">--&gt;</span>
    <span class="o">&lt;!--</span> <span class="o">&lt;</span><span class="n">activity</span>
        <span class="nl">android:</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;com.example.myfirstapp.DisplayMessageActivity&quot;</span>
        <span class="nl">android:</span><span class="n">label</span><span class="o">=</span><span class="s">&quot;@string/title_activity_display_message&quot;</span>
        <span class="nl">android:</span><span class="n">parentActivityName</span><span class="o">=</span><span class="s">&quot;com.example.myfirstapp.MainActivity&quot;</span> <span class="o">&gt;</span>
        <span class="o">&lt;!--</span> <span class="n">Parent</span> <span class="n">activity</span> <span class="n">meta</span><span class="o">-</span><span class="n">data</span> <span class="n">to</span> <span class="n">support</span> <span class="n">API</span> <span class="n">level</span> <span class="mi">7</span><span class="o">+</span> <span class="o">--&gt;</span>
        <span class="o">&lt;!--</span> <span class="o">&lt;</span><span class="n">meta</span><span class="o">-</span><span class="n">data</span>
            <span class="nl">android:</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;android.support.PARENT_ACTIVITY&quot;</span>
            <span class="nl">android:</span><span class="n">value</span><span class="o">=</span><span class="s">&quot;com.example.myfirstapp.MainActivity&quot;</span> <span class="o">/&gt;</span> <span class="o">--&gt;</span>
<span class="o">&lt;!--</span>     <span class="o">&lt;/</span><span class="n">activity</span><span class="o">&gt;</span> <span class="o">--&gt;</span>
<span class="o">&lt;!--</span> <span class="o">&lt;/</span><span class="n">application</span><span class="o">&gt;</span> <span class="o">--&gt;</span> <span class="o">--&gt;</span> <span class="o">--&gt;</span>
<span class="o">&lt;!--</span> <span class="err">```</span>    <span class="o">--&gt;</span>

<span class="o">&lt;!--</span> <span class="n">通过在Application或者Activity指定属性</span><span class="err">`</span><span class="nl">android:</span><span class="n">parentActivityName</span><span class="err">`，</span><span class="n">将其指向向上跳转的父类</span><span class="err">。</span><span class="n">在Android4</span><span class="o">.</span><span class="mi">1</span><span class="o">(</span><span class="n">API16</span><span class="o">)</span><span class="n">级以上版本中只需在Activity中指定</span><span class="err">`</span><span class="n">parentActivityName</span><span class="err">`</span><span class="n">就可以</span><span class="err">，</span><span class="n">如果为了支持低版本</span><span class="err">，</span><span class="n">需要添加</span><span class="err">`</span><span class="o">&lt;</span><span class="n">meta</span><span class="o">-</span><span class="n">data</span><span class="o">&gt;</span><span class="err">`</span><span class="n">部分</span><span class="err">。</span>
<span class="n">或者重写activity中的</span> <span class="nf">getSupportParentActivityIntent</span><span class="o">()</span> <span class="n">和</span> <span class="nf">onCreateSupportNavigateUpTaskStack</span><span class="o">()</span><span class="err">。</span>
<span class="n">取决于用户如何到达当前界面的</span><span class="err">，</span><span class="n">父级activity也可能不同</span><span class="err">，</span><span class="n">那么这么做就很合适了</span><span class="err">。</span><span class="n">也就是说</span><span class="err">，</span><span class="n">如果用户有许多可以到达当前界面的路径</span><span class="err">，</span><span class="n">那么向上按钮应该按照用户实际到达的路劲回退导航</span><span class="err">。</span>   

<span class="n">当用户按下向上按钮时系统会调用</span> <span class="nf">getSupportParentActivityIntent</span><span class="o">()</span> <span class="n">去导航你的应用</span><span class="err">（</span><span class="n">在你应用自己的任务栈内</span><span class="err">）。</span><span class="n">取决于用户如何到达当前位置的</span><span class="err">，</span><span class="n">向上导航上应该打开的activity也会不同</span><span class="err">，</span><span class="n">所以你应该重写这个方法以返回可以打开合适父级activity的</span> <span class="n">Intent</span><span class="err">。</span>  

<span class="n">当用户按下向上按钮并且你的activity也运行在不属于你应用的任务栈中时</span><span class="err">，</span><span class="n">系统会为你的activity调用</span> <span class="nf">onCreateSupportNavigateUpTaskStack</span><span class="o">()</span><span class="err">。</span><span class="n">因此</span><span class="err">，</span><span class="n">当用户向上导航时你必须使用</span> <span class="n">TaskStackBuilder</span> <span class="n">传递到这个方法去建立那个应该合并的合适的回退栈</span><span class="err">。</span>    

<span class="n">虽然你重写了</span> <span class="nf">getSupportParentActivityIntent</span><span class="o">()</span> <span class="n">来具体指定用户在应用中的具体导航</span><span class="err">，</span><span class="n">但是你不想实现</span> <span class="nf">onCreateSupportNavigateUpTaskStack</span><span class="o">()</span><span class="err">，</span><span class="n">那么你可以像上面所示在清单文件中声明</span><span class="err">“</span><span class="n">默认</span><span class="err">”</span><span class="n">父级activity达到同样的效果</span><span class="err">。</span><span class="n">然后</span> <span class="nf">onCreateSupportNavigateUpTaskStack</span><span class="o">()</span> <span class="n">的默认实现会基于清单中声明的父级activity去合并回退栈</span><span class="err">。</span>   
<span class="n">注解</span><span class="err">：</span><span class="n">如果你是使用大量的fragment而不是activity去构建你应用层级结构</span><span class="err">，</span><span class="n">那么上面的选项都不会生效</span><span class="err">。</span><span class="n">要在fragment里向上导航</span><span class="err">，</span><span class="n">你应该改为重写</span> <span class="nf">onSupportNavigateUp</span><span class="o">()</span><span class="err">，</span><span class="n">通常通过调用</span> <span class="nf">popBackStack</span><span class="o">()</span> <span class="n">方法把当前fragment从回退栈里出栈去来执行合适的fragment事务</span><span class="err">。</span>    
<span class="err">###</span><span class="n">操作视图</span>
<span class="n">在app中经常见到一种情况就是在ActionBar中点击搜索按钮</span><span class="err">，</span><span class="n">弹出搜索条</span><span class="err">，</span><span class="n">这个功能就可以通过只需要在Item中指定</span><span class="err">`</span><span class="nl">app:</span><span class="n">actionViewClass</span><span class="err">`</span><span class="n">属性</span><span class="err">，</span><span class="n">同时在</span><span class="err">`</span><span class="nl">app:</span><span class="n">showAsAction</span><span class="err">`</span><span class="n">添加collapseActionView值就可完成</span><span class="err">。</span><span class="n">collapseActionView是用来声明操作视图应该被收缩到一个按钮中的可选操作</span><span class="err">。</span>
</pre></div>